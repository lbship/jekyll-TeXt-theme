# 一、背景和目标

源于沃尔玛的啤酒和尿布的经典营销案例，把这两个看似并无太大关系的商品联系到一起了。这里就用到了关联算法。我们今天就用关联算法对某餐饮连锁企业的商品进行关联分析，观察用户的消费习惯。

环境：python3.5+pycharm

算法：Apriori

# 二、数据采集和处理

原始数据是长这样的,不过这样的数据并不利于进行关联分析:
![image](https://raw.githubusercontent.com/lbship/lbship.github.io/master/img/hadoop2.6/A1.png) 


不过阿里云分析型数据库ADB提供了强大的group_concat函数，类似于分组效果，可以把聚合之后的查询结果放在一起。

用法:select 日期，订单,group_concat(产品) from 表 group by 日期，订单

具体结果如下：


![image](https://raw.githubusercontent.com/lbship/lbship.github.io/master/img/hadoop2.6/A2.png) 
# 三、过程

a和b的支持度support（a->b）=P(a&b)=support_count(a&b)/total_count(a)，最小支持度设置为0.2

a和b的置信度confidence(a->b)=P(b|a)=support_count(a&b)/support_count(a)，最小置信度设置为0.5

概念：如果项集I的支持度大于最小支持度阈值，则I为频繁项集，频繁项集的非空子集也是频繁项集。

- a.计算频繁项集过程：

1.连接 

以上面9个订单为例,123002这个产品在4个订单出现，所以p(123002)=4/9，以此类推得到C1，

|产品|	概率|	是否大于最小支持度|
| :------| ------: | :------: |
|123002|	4/9	|是
|131013|	5/9|	是
|110202|	2/9|	否

…..	…..	…..
2.剪枝和再连接

把小于最小支持度（设置为0.2）的排除了，就得到了频繁项集L1，然后L1和L1自相连，得到C2

|产品	|概率	|是否大于最小支持度|
| :------| ------: | :------: |
|123,002,131,013	|4/9|	是|
|123,002,110,202|	1/9|	否|

…..	…..	…..
 

排除之后得到二项集L2，三项集L3知道找到最大频繁项集Ln.......

- b.计算置信度过程

p(123002|131013)=p(123002&131013)/p(131013)=(4/9)/(5/9)=0.8

- c.结论：

131013->123002     最小支持度为4/9  ,置信度为0.8 

同时点这两个产品的概率为4/9,点了131013之后再点123002的概率是0.8，而且同时满足最小支持度和最小置信度，所以这两个产品之间有很强的关联关系
